<!doctype html>
<meta charset="utf-8">
<title>Test Checkout</title>

<button id="pay" style="padding:12px 18px;border-radius:10px;background:black;color:white">
  Proceder al pago (TEST)
</button>

<script src="https://sdk.mercadopago.com/js/v2"></script>
<script>
  const MP_PUBLIC_KEY = 'APP_USR-5bf9ff8a-c192-4c4a-afa4-7e6b326cd0cb';
  const BACKEND_URL   = 'https://grailmarket.onrender.com';

  async function testCheckout(){
    try {
      const res = await fetch(`${BACKEND_URL}/api/create_preference`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ items: [{ title:'Test', unit_price: 1000, quantity: 1 }] })
      });
      const data = await res.json();
      if (!res.ok || !data.preferenceId) {
        alert('Fallo al crear preferencia. Revisa la consola (F12).');
        console.log('status', res.status, data);
        return;
      }
      const mp = new MercadoPago(MP_PUBLIC_KEY, { locale: 'es-CL' });
      mp.checkout({
        preference: { id: data.preferenceId },
        autoOpen: true,
        redirectMode: 'self',
        theme: { elementsColor: '#FF7A00' }
      });
    } catch (e) {
      console.error(e);
      alert('Error al iniciar el pago. Mira la consola.');
    }
  }

  document.getElementById('pay').addEventListener('click', testCheckout);
</script>
